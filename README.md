# ç”µå­ä¹¦è½¬æ¢å™¨ (Ebook Generator)

> åŸºäº Web çš„å°è¯´è½¬æ¢å·¥å…·ï¼Œæ”¯æŒå°† txt æ–‡ä»¶è½¬æ¢ä¸º epubã€mobiã€azw3 ç­‰ç”µå­ä¹¦æ ¼å¼

æœ¬é¡¹ç›®æ˜¯ä» [ystyle/kaf-cli](https://github.com/ystyle/kaf-cli) fork è€Œæ¥ï¼Œåœ¨ä¿ç•™åŸæœ‰å‘½ä»¤è¡ŒåŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œæ–°å¢äº† Web å¯è§†åŒ–ç•Œé¢ï¼Œæä¾›æ›´ä¾¿æ·çš„ä½¿ç”¨ä½“éªŒã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸŒ Web åŠŸèƒ½
- ğŸ“ **æ–‡ä»¶ä¸Šä¼ **ï¼šæ”¯æŒ txt æ–‡ä»¶ä¸Šä¼ ï¼Œæœ€å¤§ 50MB
- ğŸ”„ **æ ¼å¼è½¬æ¢**ï¼šæ”¯æŒè½¬æ¢ä¸º epubã€mobiã€azw3 æ ¼å¼
- ğŸ“Š **å®æ—¶è¿›åº¦**ï¼šé€šè¿‡ SSE å®æ—¶æŸ¥çœ‹è½¬æ¢è¿›åº¦
- ğŸ“¥ **æ–‡ä»¶ä¸‹è½½**ï¼šè½¬æ¢å®Œæˆåå¯ä¸‹è½½ç”µå­ä¹¦æ–‡ä»¶
- ğŸ—‘ï¸ **è‡ªåŠ¨æ¸…ç†**ï¼šæ”¯æŒæ‰‹åŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- ğŸ“– **API æ–‡æ¡£**ï¼šé›†æˆ Swagger UIï¼Œæ–¹ä¾¿è°ƒè¯•
- ğŸ¨ **å¯è§†åŒ–ç•Œé¢**ï¼šç®€æ´æ˜“ç”¨çš„ HTML ç•Œé¢

### ğŸ“š è½¬æ¢åŠŸèƒ½
- è‡ªåŠ¨è¯†åˆ«ä¹¦åå’Œç« èŠ‚
- è‡ªåŠ¨è¯†åˆ«å­—ç¬¦ç¼–ç ï¼ˆè§£å†³ä¸­æ–‡ä¹±ç ï¼‰
- è‡ªå®šä¹‰ç« èŠ‚æ ‡é¢˜è¯†åˆ«è§„åˆ™
- è‡ªå®šä¹‰å·çš„æ ‡é¢˜è¯†åˆ«è§„åˆ™
- è‡ªåŠ¨ç»™ç« èŠ‚æ­£æ–‡ç”ŸæˆåŠ ç²—å±…ä¸­çš„æ ‡é¢˜
- æ®µè½è‡ªåŠ¨è¯†åˆ«å’Œç¼©è¿›
- æ”¯æŒç”Ÿæˆ Orly é£æ ¼çš„ä¹¦ç±å°é¢
- çŸ¥è½©è—ä¹¦æ ¼å¼æ–‡ä»¶åè‡ªåŠ¨æå–ä¹¦åå’Œä½œè€…
- è¶…å¿«é€Ÿè½¬æ¢ï¼ˆepub æ ¼å¼ç”Ÿæˆ 300 ç« /s ä»¥ä¸Šé€Ÿåº¦ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šWeb æœåŠ¡ï¼ˆæ¨èï¼‰

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/Deali-Axy/ebook-generator.git
cd ebook-generator
```

#### 2. å®‰è£…ä¾èµ–

```bash
go mod tidy
```

#### 3. å¯åŠ¨ Web æœåŠ¡

```bash
go run cmd/web/main.go
```

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨

#### 4. ä½¿ç”¨å¯è§†åŒ–ç•Œé¢

- æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8080`
- ä¸Šä¼  txt æ–‡ä»¶
- è®¾ç½®ä¹¦åã€ä½œè€…ç­‰å‚æ•°
- é€‰æ‹©è¾“å‡ºæ ¼å¼
- ç‚¹å‡»å¼€å§‹è½¬æ¢
- å®æ—¶æŸ¥çœ‹è½¬æ¢è¿›åº¦
- ä¸‹è½½ç”Ÿæˆçš„ç”µå­ä¹¦

#### 5. æŸ¥çœ‹ API æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8080/swagger/index.html`

### æ–¹å¼äºŒï¼šä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶

- ç”µè„‘ç‰ˆ kaf-cli: [Github ä¸‹è½½](https://github.com/Deali-Axy/ebook-generator/releases/latest)
- åŒ…ç®¡ç†å™¨å®‰è£…:
  - Archlinux: `yay -S kaf-cli`
  - Windows: `winget install kaf-cli`

## ğŸ“– Web API æ¥å£

### æ–‡ä»¶ä¸Šä¼ 

```http
POST /api/upload
Content-Type: multipart/form-data

å‚æ•°ï¼š
- file: txtæ–‡ä»¶ï¼ˆæœ€å¤§50MBï¼‰

å“åº”ï¼š
{
  "code": 200,
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ",
  "data": {
    "task_id": "task_1234567890",
    "filename": "example.txt",
    "size": 1024000,
    "upload_at": "2024-01-01T00:00:00Z"
  }
}
```

### å¼€å§‹è½¬æ¢

```http
POST /api/convert
Content-Type: application/json

{
  "task_id": "task_1234567890",
  "bookname": "ç¤ºä¾‹å°è¯´",
  "author": "ä½œè€…å",
  "format": "epub",
  "match": "^ç¬¬[0-9ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åé›¶ã€‡ç™¾åƒä¸¤ ]+[ç« å›èŠ‚é›†å¹•å·éƒ¨]"
}
```

### æŸ¥è¯¢çŠ¶æ€

```http
GET /api/status/{taskId}

å“åº”ï¼š
{
  "code": 200,
  "message": "è·å–çŠ¶æ€æˆåŠŸ",
  "data": {
    "task_id": "task_1234567890",
    "status": "completed",
    "progress": 100,
    "message": "è½¬æ¢å®Œæˆ",
    "files": [
      {
        "file_id": "file_1234567890",
        "format": "epub",
        "filename": "example.epub",
        "size": 2048000
      }
    ]
  }
}
```

### å®æ—¶äº‹ä»¶æµï¼ˆSSEï¼‰

```http
GET /api/events/{taskId}
Accept: text/event-stream

äº‹ä»¶æ ¼å¼ï¼š
data: {
  "task_id": "task_1234567890",
  "event_type": "progress",
  "message": "æ­£åœ¨è§£ææ–‡ä»¶",
  "progress": 50,
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### ä¸‹è½½æ–‡ä»¶

```http
GET /api/download/{fileId}

å“åº”ï¼šæ–‡ä»¶æµ
```

### æ¸…ç†ä»»åŠ¡

```http
DELETE /api/cleanup/{taskId}

å“åº”ï¼š
{
  "code": 200,
  "message": "æ¸…ç†æˆåŠŸ",
  "data": {
    "task_id": "task_1234567890",
    "cleaned": true,
    "cleaned_files": ["/path/to/file1", "/path/to/file2"],
    "cleaned_at": "2024-01-01T00:00:00Z"
  }
}
```

## âš™ï¸ è½¬æ¢å‚æ•°è¯´æ˜

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|----------|
| task_id | string | æ˜¯ | - | ä»»åŠ¡IDï¼ˆä»ä¸Šä¼ æ¥å£è·å–ï¼‰ |
| bookname | string | æ˜¯ | - | ä¹¦å |
| author | string | å¦ | "YSTYLE" | ä½œè€… |
| format | string | æ˜¯ | - | è¾“å‡ºæ ¼å¼ï¼šepub/mobi/azw3/all |
| match | string | å¦ | é»˜è®¤è§„åˆ™ | ç« èŠ‚åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ |
| volume_match | string | å¦ | é»˜è®¤è§„åˆ™ | å·åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ |
| exclusion_pattern | string | å¦ | é»˜è®¤è§„åˆ™ | æ’é™¤è§„åˆ™æ­£åˆ™è¡¨è¾¾å¼ |
| max | uint | å¦ | 35 | æ ‡é¢˜æœ€å¤§å­—æ•° |
| indent | uint | å¦ | 2 | æ®µè½ç¼©è¿› |
| align | string | å¦ | "center" | æ ‡é¢˜å¯¹é½æ–¹å¼ |
| unknow_title | string | å¦ | "ç« èŠ‚æ­£æ–‡" | æœªçŸ¥ç« èŠ‚åç§° |
| cover | string | å¦ | "gen" | å°é¢è®¾ç½® |
| tips | bool | å¦ | true | æ˜¯å¦æ·»åŠ æ•™ç¨‹æ–‡æœ¬ |
| lang | string | å¦ | "zh" | è¯­è¨€è®¾ç½® |

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t ebook-generator .

# è¿è¡Œå®¹å™¨
docker run -d -p 8080:8080 --name ebook-generator ebook-generator
```

### ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|----------|
| PORT | 8080 | æœåŠ¡ç«¯å£ |
| GIN_MODE | debug | Ginè¿è¡Œæ¨¡å¼ |

### ç›®å½•ç»“æ„

```
web/
â”œâ”€â”€ uploads/    # ä¸Šä¼ æ–‡ä»¶ä¸´æ—¶ç›®å½•
â””â”€â”€ outputs/    # è½¬æ¢åæ–‡ä»¶ç›®å½•
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨ curl è°ƒç”¨ API

#### 1. ä¸Šä¼ æ–‡ä»¶

```bash
curl -X POST http://localhost:8080/api/upload \
  -F "file=@example.txt"
```

#### 2. å¼€å§‹è½¬æ¢

```bash
curl -X POST http://localhost:8080/api/convert \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": "task_1234567890",
    "bookname": "ç¤ºä¾‹å°è¯´",
    "author": "ä½œè€…å",
    "format": "epub"
  }'
```

#### 3. æŸ¥è¯¢çŠ¶æ€

```bash
curl http://localhost:8080/api/status/task_1234567890
```

#### 4. ä¸‹è½½æ–‡ä»¶

```bash
curl -O http://localhost:8080/api/download/file_1234567890
```

## ğŸ“ ä»»åŠ¡çŠ¶æ€è¯´æ˜

- `pending`: ç­‰å¾…ä¸­
- `processing`: å¤„ç†ä¸­
- `completed`: å·²å®Œæˆ
- `failed`: å¤±è´¥
- `cancelled`: å·²å–æ¶ˆ

## âš ï¸ æ³¨æ„äº‹é¡¹

1. ä¸Šä¼ çš„æ–‡ä»¶å¿…é¡»æ˜¯ UTF-8 ç¼–ç çš„ txt æ–‡ä»¶
2. æ–‡ä»¶å¤§å°é™åˆ¶ä¸º 50MB
3. è½¬æ¢åçš„æ–‡ä»¶ä¼šä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œå»ºè®®å®šæœŸæ¸…ç†
4. SSE è¿æ¥ä¼šåœ¨ 30 ç§’æ— æ´»åŠ¨åå‘é€å¿ƒè·³åŒ…
5. ä»»åŠ¡å®Œæˆåå»ºè®®è°ƒç”¨æ¸…ç†æ¥å£é‡Šæ”¾å­˜å‚¨ç©ºé—´

## ğŸ”§ é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ |
|--------|----------|
| 200 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## ğŸ“± å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆä¼ ç»ŸåŠŸèƒ½ï¼‰

### åŸºæœ¬ä½¿ç”¨

```bash
# ç®€å•æ¨¡å¼ï¼ˆæ‹–æ‹½åŠŸèƒ½ï¼‰
kaf-cli ~/å…¨èŒæ³•å¸ˆ.txt

# è‡ªå®šä¹‰ä½œè€…
kaf-cli -author ä¹± -filename ~/å…¨èŒæ³•å¸ˆ.txt

# è‡ªå®šä¹‰ç« èŠ‚åŒ¹é…
kaf-cli -filename ~/å°è¯´.txt -match "ç¬¬.{1,8}èŠ‚"
```

### ä¸»è¦å‚æ•°

- `-author`: ä½œè€…å
- `-bookname`: ä¹¦å
- `-format`: è¾“å‡ºæ ¼å¼ï¼ˆepub/mobi/azw3/allï¼‰
- `-match`: ç« èŠ‚åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼
- `-cover`: å°é¢è®¾ç½®

æ›´å¤šè¯¦ç»†å‚æ•°è¯·å‚è€ƒåŸé¡¹ç›®æ–‡æ¡£æˆ–ä½¿ç”¨ `kaf-cli -h` æŸ¥çœ‹ã€‚

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ™ è‡´è°¢

- åŸé¡¹ç›®ï¼š[ystyle/kaf-cli](https://github.com/ystyle/kaf-cli)
- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…çš„æ”¯æŒ

## ğŸ“ è”ç³»

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ GitHub Issues è”ç³»ã€‚

